<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/main.css" />
		<script src="js/rem.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
		<title></title>
		<style type="text/css">
			.nav .shop .img-box img{width: 45%;}
		</style>
	</head>
	<body>
		<div class="wrapper nav">
			<!--头部-->
			<div class="header">
				<div class="head-tab mui-action-back">
					<img src="img/Arrow_Simple_left Copy@2x.png" class="back"/>
				</div>
				<div class="head-main">
					购买物料包
				</div>
				<div class="head-tab">
					
				</div>
			</div>
			<!--中间主体-->
			<div class="main">
				<div class="shop-box">
					<div class="shop" v-for="(val,index) in navdata" @click="opendetail(val.pbMaterialPackageId)">
						<div class="img-box">
							<img src="img/liwu.png"/>
						</div>
						<div class="price-box">
							<div class="name">{{val.pbMpName}}</div>
							<div class="price">￥{{val.pbMpPrice}}</div>
						</div>
						<div class="subtitile">库存：{{val.pbMpStock}}</div>
						<div class="add-box">
							<img src="img/Close-2 Copy 9@2x.png"  @click.stop="addnum('j',index)" />
							<div class="num">{{val.packageNum}}</div>
							<img src="img/Close-2 Copy 6@2x.png" @click.stop="addnum('z',index)"/>
						</div>
					</div>
				</div>
			</div>
			<div class="bottom">
				<div class="nav-left" @click="alertshow">
					<div class="bprice">合计:￥{{allnum}}</div>
				</div>
				<div class="nav-right" @click="pay()">
					去结算
				</div>
			</div>
		</div>
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var myvue=new Vue({
				el:'.wrapper',
				data:{
					alertboo:false,
					navdata:'',
					cartdata:[],
					allnum:0
				},
				methods:{
					pay:function(){
						var that=this
						$.ajax({
							type:"post",
							url:localStorage.getItem('myurl')+"/usCityPartner/buyActivityPackage",
							dataType:'json',
							success:function(res){
								console.log(res)
								for (var i=0;i<res.data.length;i++) {
									res.data[i].packageNum=0
								}
								that.navdata=res.data
							}
						});
					},
					addnum: function(type, index) {
						var that = this
						if(type == 'j') {
							if(this.navdata[index].packageNum > 0) {
								this.navdata[index].packageNum--
							}
						} else {
							this.navdata[index].packageNum++
						}
						that.allnum = 0
						that.cartdata=[]
						for(var i = 0; i < that.navdata.length; i++) {
							if(that.navdata[i].packageNum > 0) {
								that.cartdata.push(that.navdata[i])
								that.allnum += that.navdata[i].packageNum * that.navdata[i].pbMpPrice
							}
						}
					},
					opendetail:function(id){
						localStorage.setItem('pbMaterialPackageId',id)
						this.opennew('shopdetail')
					},
					alertshow:function(){
						this.alertboo=!this.alertboo
					},
					opennew:function(target,id){
						mui.openWindow({
							url:'./'+target+'.html',
							id:target
						})
					},
					myajax:function(){
						var that=this
						$.ajax({
							type:"post",
							url:localStorage.getItem('myurl')+"/usCityPartner/queryPbMaterialPackage",
							dataType:'json',
							success:function(res){
								console.log(res)
								for (var i=0;i<res.data.length;i++) {
									res.data[i].packageNum=0
								}
								that.navdata=res.data
							}
						});
					}
				},
				mounted:function(){
					this.myajax()
				}
			})
		</script>
	</body>
</html>